name: Release

on: 
  push:
    branches:
    - feature/automatedBuilds

env:
  NODE_VERSION: '16'
  EXTENSION_OUTPUT_FILE: 'csharpextensions.vsix'

jobs:
  prepare:
    name: Prepare
    runs-on: ubuntu-latest
    steps:
    - uses: DerYeger/yarn-setup-action@master
      with:
        node-version: ${{ env.NODE_VERSION }}

  lint:
    name: Lint
    runs-on: ubuntu-latest
    needs: prepare
    steps:
    - uses: DerYeger/yarn-setup-action@master
      with:
        node-version: ${{ env.NODE_VERSION }}
    - run: yarn lint

  package:
    name: Package
    runs-on: ubuntu-latest
    needs: prepare
    steps:
    - uses: DerYeger/yarn-setup-action@master
      with:
        node-version: ${{ env.NODE_VERSION }}
    - name: Yarn package
      run: yarn package -o ${{ env.EXTENSION_OUTPUT_FILE }}
    
    - name: Upload artifact
      uses: actions/upload-artifact@v2
      with:
        name: ${{ env.EXTENSION_OUTPUT_FILE }}
        path: ${{ env.EXTENSION_OUTPUT_FILE }}
        retention-days: 30
